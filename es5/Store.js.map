{"version":3,"sources":["../src/Store.js"],"names":["Store","onChangeCallbacks","__anyChange","state","stateHistory","index","length","property","newValue","oldValue","forEach","callback","newState","oldState","push","assign","anyChanges","newProperty","oldProperty","triggerChangeCallbacks","undefined","console","error"],"mappings":";;;;;;;qjBAAA;;;;;AAGA;;;;;;;;IAEaA,K,WAAAA,K;AACT,qBAAa;AAAA;;AACT,aAAKC,iBAAL,GAAyB;AACrBC,yBAAa;AADQ,SAAzB;AAGA,aAAKC,KAAL,GAAa,EAAb;AACA,aAAKC,YAAL,GAAoB,EAApB;AACH;;;;2CAEiB;AACd,gBAAIC,QAAQ,KAAKD,YAAL,CAAkBE,MAAlB,GAA2B,CAAvC;;AAEA,mBAAO,KAAKF,YAAL,CAAkBC,KAAlB,CAAP;AACH;;;+CAEsBE,Q,EAAUC,Q,EAAUC,Q,EAAS;AAChD,gBAAG,CAAC,KAAKR,iBAAL,CAAuBM,QAAvB,CAAJ,EAAsC;;AAEtC,iBAAKN,iBAAL,CAAuBM,QAAvB,EAAiCG,OAAjC,CAAyC,UAACC,QAAD;AAAA,uBAAYA,SAASH,QAAT,EAAmBC,QAAnB,EAA6BF,QAA7B,CAAZ;AAAA,aAAzC;AACH;;;iCAEQK,Q,EAAS;AACd;AACA,gBAAIC,WAAW,KAAKV,KAApB;AACA,iBAAKC,YAAL,CAAkBU,IAAlB,CAAuBD,QAAvB;;AAEA;AACA,iBAAKV,KAAL,GAAa,iBAAEY,MAAF,CAAS,EAAT,EAAa,KAAKZ,KAAlB,EAAyBS,QAAzB,CAAb;;AAEA;AACA,gBAAII,aAAa,KAAjB;AACA,iBAAI,IAAIT,QAAR,IAAoB,KAAKJ,KAAzB,EAA+B;AAC3B,oBAAIc,cAAc,KAAKd,KAAL,CAAWI,QAAX,CAAlB;AACA,oBAAIW,cAAcL,SAASN,QAAT,CAAlB;AACA,oBAAGU,gBAAgBC,WAAnB,EAA+B;AAC3B;AACA,yBAAKC,sBAAL,CAA4BZ,QAA5B,EAAsCU,WAAtC,EAAmDC,WAAnD;AACAF,iCAAa,IAAb;AACH;AACJ;;AAED,gBAAGA,UAAH,EAAe,KAAKG,sBAAL,CAA4B,aAA5B,EAA2C,KAAKhB,KAAhD,EAAuDU,QAAvD;AAClB;;;2CAEkBF,Q,EAAmC;AAAA,gBAAzBJ,QAAyB,uEAAd,aAAc;;AAClD,gBAAG,KAAKN,iBAAL,CAAuBM,QAAvB,KAAoCa,SAAvC,EAAkD,KAAKnB,iBAAL,CAAuBM,QAAvB,IAAmC,EAAnC;;AAElD,gBAAG,OAAOI,QAAP,IAAmB,UAAtB,EAAiC;AAC7BU,wBAAQC,KAAR,CAAc,8CAAd;AACH,aAFD,MAEM;AACF,qBAAKrB,iBAAL,CAAuBM,QAAvB,EAAiCO,IAAjC,CAAsCH,QAAtC;AACH;AACJ;;;;;;kBAGUX,K","file":"Store.js","sourcesContent":["/**\r\n * Created by sam_g on 2/7/2017.\r\n */\r\nimport _ from 'lodash';\r\n\r\nexport class Store{\r\n    constructor(){\r\n        this.onChangeCallbacks = {\r\n            __anyChange: []\r\n        };\r\n        this.state = {};\r\n        this.stateHistory = [];\r\n    }\r\n\r\n    getPreviousState(){\r\n        let index = this.stateHistory.length - 1;\r\n\r\n        return this.stateHistory[index];\r\n    }\r\n\r\n    triggerChangeCallbacks(property, newValue, oldValue){\r\n        if(!this.onChangeCallbacks[property]) return;\r\n\r\n        this.onChangeCallbacks[property].forEach((callback)=>callback(newValue, oldValue, property));\r\n    }\r\n\r\n    setState(newState){\r\n        // Save the old state\r\n        let oldState = this.state;\r\n        this.stateHistory.push(oldState);\r\n\r\n        // Update the state\r\n        this.state = _.assign({}, this.state, newState);\r\n\r\n        // Generate list of shallow changes\r\n        let anyChanges = false;\r\n        for(let property in this.state){\r\n            let newProperty = this.state[property];\r\n            let oldProperty = oldState[property];\r\n            if(newProperty !== oldProperty){\r\n                // changes.push(property);\r\n                this.triggerChangeCallbacks(property, newProperty, oldProperty);\r\n                anyChanges = true;\r\n            }\r\n        }\r\n\r\n        if(anyChanges) this.triggerChangeCallbacks(\"__anyChange\", this.state, oldState);\r\n    }\r\n\r\n    subscribeToChanges(callback, property = \"__anyChange\"){\r\n        if(this.onChangeCallbacks[property] == undefined) this.onChangeCallbacks[property] = [];\r\n\r\n        if(typeof callback != \"function\"){\r\n            console.error(\"Callback given is not a function as expected\");\r\n        }else {\r\n            this.onChangeCallbacks[property].push(callback);\r\n        }\r\n    }\r\n}\r\n\r\nexport default Store;"]}